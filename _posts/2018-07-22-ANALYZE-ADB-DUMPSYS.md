---
layout: post
title: "180722 ANALYZE ADB DUMPSYS"
date:   2018-07-22 14:00:30 +0900
categories: jekyll update
---

이제 전체적인 액티비티 매니저의 구조를 파악하였기 때문에, 실제 어플리케이션이 구동되는 환경에서

각각의 액티비티, 태스크, 액티비티 스택 등이 어떻게 변하는 지 알아보기 위해서 실제 디바이스를 통해

분석을 해보았다. 분석을 진행한 환경은 

윈도우 환경에서의 ADB(Android Debug Bridge) , 갤럭시노트5 를 이용하였다.

전체적인 시나리오를 구성하여, 해당 시나리오대로 진행하면서 분석을 하였다.

그 시나리오는 아래와 같다.

1. 부팅

2. 카카오톡 어플리케이션 실행

3. 홈 버튼을 눌러 홈으로 돌아간 후, 인터넷 브라우저 실행

4. 카카오톡에서 채팅 룸으로 들어간 후, 유튜브 링크 클릭

5. 메세지로 온 유튜브 링크 클릭

***

1. 기기 부팅 후 리센트 태스크 리스트

![adb01](https://user-images.githubusercontent.com/28890428/43467729-5b88a35e-951d-11e8-870e-8d4541f1b8fc.PNG)

리센트 태스크 리스트의 넘버링은 가장 최근에 실행된 태스크가 0번이 되고, 그 전에 있던 태스크들은

번호가 하나씩 밀려난다.

2번 태스크는 홈 런처의 태스크이다. 따라서 0번 액티비티 스택, 즉 홈스택에 들어 있다.

4번 태스크는 briefing 이라는 기능을 사용하기 위한 태스크인데, 특수한 액티비티 스택을 만들어낸다.

5번 태스크와 1번 태스크는 1번 액티비티스택에 들어가 있다고 나오는데, 1번 액티비티 스택은 어플리케이션 스택으로

아직은 만들어져있지 않다. 위 2개의 태스크는 특수한 목적을 위해 만들어진 태스크로 보인다.

***

2. 기기 부팅 후 액티비티들

![adb02](https://user-images.githubusercontent.com/28890428/43468233-72714aca-951e-11e8-8106-a85655cb6915.PNG)

위 사진을 보면 현재 액티비티 스택이 0번 스택과 1001번 스택이 있는 걸 볼 수 있는데,

1001번 스택은 위에서 말한 briefing 이라는 기술을 사용하기 위해 만들어진 특수한 목적의 스택이다.

현재 0번 스택(홈스택)만 있는 상황이고 해당 스택에는 2번 태스크가 있고 2번 태스크 내부에는 

단 하나의 액티비티가 있는 걸 볼 수 있다. 이 액티비티는 홈 런처의 액티비티이다.

***

3. 카카오톡 어플리케이션 실행

![adb03](https://user-images.githubusercontent.com/28890428/43468409-d7c16ea0-951e-11e8-9aa4-3e7f47a023b9.PNG)

카카오톡 어플리케이션을 실행 후, 리센트 태스크 리스트의 0번 태스크가 카카오톡 태스크가 된 것을 볼 수 있다.

해당 태스크의 스택 아이디는 1번 스택으로, 어플리케이션 스택이다.

![adb04](https://user-images.githubusercontent.com/28890428/43468457-05540008-951f-11e8-91cd-df1dd354483b.PNG)

액티비티 목록을 보면 1번 스택이 생성된 것을 확인할 수 있다.

해당 스택에는 하나의 태스크가 존재하고 이 태스크의 액티비티는 2개가 존재한다.

0번 액티비티는 카카오톡이 처음 실행할 때 생기는 root activity이고, 

1번 액티비티는 카카오톡이 실행된 후, 메인 화면, 즉 아래의 화면이다.

![kakaotalk_20180801_001400200](https://user-images.githubusercontent.com/28890428/43468866-ee07a9c6-951f-11e8-97f5-50fdc51f36ec.png)

위 화면에서 채팅 목록과 친구 목록 등을 바꾸어도 액티비티는 변하지 않고 같은 액티비티이다.

채팅 목록, 친구 목록 등은 fragment로 구현되어 있기 때문이다.

***

4. 홈 버튼을 누른 후, 인터넷 브라우저 실행

![adb05](https://user-images.githubusercontent.com/28890428/43468791-c99be6d8-951f-11e8-88ca-0878ff43edc3.PNG)

카카오톡이 켜져 있는 상태에서, 홈 버튼을 눌러 홈 태스크가 0번이 되었다가, 인터넷 브라우저가 실행되어서,

홈 태스크가 1번이 되고, 인터넷 브라우저의 태스크가 0번이 되었다.

![adb06](https://user-images.githubusercontent.com/28890428/43468973-20fffa22-9520-11e8-92a1-1e6bf2c0ed69.PNG)
![adb07](https://user-images.githubusercontent.com/28890428/43469105-68f05b4c-9520-11e8-8930-f9bc468e3718.PNG)

액티비티들을 보면 액티비티 스택 1번 , 즉 어플리케이션 스택에 새로운 태스크(인터넷 브라우저)가 추가된 것을 볼 수 있다.

0번 스택 홈스택은 변화가 없다.

***

5. 카카오톡의 채팅 룸에서 유튜브 링크 클릭

![adb08](https://user-images.githubusercontent.com/28890428/43469173-8d3e9036-9520-11e8-8e19-6be6841530de.PNG)

위 사진을 보면 유튜브 링크를 클릭했음에도, 유튜브 태스크는 생성되지 않은 것을 볼 수 있다.

![adb09](https://user-images.githubusercontent.com/28890428/43469259-bd6744d8-9520-11e8-9dbf-aa1ad92501ce.PNG)

카카오톡의 개발자가 카카오톡에 넣어둔 유튜브 API로 인해, 유튜브 태스크가 새로 생기지 않고,

새로운 액티비티가 생겨서 유튜브의 동영상 코드를 이용하여 인앱형태로 유튜브를 보여주는 형식이다.

그렇다면 인앱 형식이 아닌 곳에서 유튜브 동영상 링크를 열면 어떻게 될까?

***

6. 메세지로 받은 유튜브 링크 클릭

![adb11](https://user-images.githubusercontent.com/28890428/43469359-f2f70b24-9520-11e8-8697-332bad8bc4ef.PNG)

메세지로 받은 유튜브 링크를 클릭하니, 유튜브 어플리케이션이 실행되면서 유튜브 태스크가 새로 생겼다.

![adb12](https://user-images.githubusercontent.com/28890428/43469419-1994e60c-9521-11e8-8a6c-0d15667da252.PNG)

***

전체적인 액티비티 매니저의 구조를 알게 된 후,

이렇게 실제 기기를 통해 디버그를 해보니 더 확실해졌고, 전체적인 흐름에 대해 더 명확해졌다.
